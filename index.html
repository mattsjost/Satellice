<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Satellice</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.5.2/ol.css">
  <script src="https://cdn.jsdelivr.net/npm/ol@7.5.2/dist/ol.js"></script>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    #wrap {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    #controls {
      background: #f5f5f5;
      padding: 8px 12px;
      border-bottom: 2px solid #ccc;
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }
    .date-control {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .date-control label {
      font-weight: bold;
      font-size: 13px;
    }
    .date-display {
      font-family: monospace;
      font-size: 13px;
      min-width: 80px;
      text-align: center;
      padding: 4px 8px;
      background: white;
      border: 1px solid #999;
      border-radius: 3px;
    }
    .date-display.default {
      color: #666;
      font-style: italic;
    }
    .date-display.modified {
      color: #000;
    }
    button {
      padding: 5px 10px;
      cursor: pointer;
      border: 1px solid #666;
      background: white;
      border-radius: 3px;
      font-size: 12px;
      white-space: nowrap;
    }
    button:hover {
      background: #e0e0e0;
    }
    button:active {
      background: #d0d0d0;
    }
    .reset-btn {
      margin-left: auto;
      background: #0066cc;
      color: white;
      border-color: #0055aa;
      font-weight: bold;
    }
    .reset-btn:hover {
      background: #0055aa;
    }
    .zoom-control {
      display: flex;
      gap: 5px;
      margin-left: auto;
    }
    #maps {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    .map {
      flex: 1;
      min-width: 0;
      position: relative;
    }
    /* Dölj OpenLayers zoom-knappar */
    .ol-zoom {
      display: none;
    }
    /* Förstora overlay-text med CSS zoom */
    .map::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1000;
    }
    
    /* Responsiv design för mobil */
    @media (max-width: 768px) {
      #controls {
        padding: 6px 8px;
        gap: 8px;
        font-size: 12px;
      }
      .date-control label {
        min-width: auto;
        font-size: 11px;
      }
      .date-display {
        min-width: 70px;
        font-size: 11px;
        padding: 3px 6px;
      }
      button {
        padding: 4px 8px;
        font-size: 11px;
      }
      .reset-btn {
        margin-left: 0;
        width: 100%;
        order: 10;
      }
      .zoom-control {
        margin-left: 0;
      }
      #maps {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
<!-- Version: 1.1 -->
<div id="wrap">
  <div id="controls">
    <div class="date-control">
      <label>Radar:</label>
      <button onclick="changeDate(1, -1)">◄</button>
      <div class="date-display default" id="date1">Senaste</div>
      <button onclick="changeDate(1, 1)">►</button>
    </div>
    <div class="date-control">
      <label>Optisk:</label>
      <button onclick="changeDate(2, -1)">◄</button>
      <div class="date-display default" id="date2">Senaste</div>
      <button onclick="changeDate(2, 1)">►</button>
    </div>
    <div class="zoom-control">
      <button onclick="zoomIn()">+</button>
      <button onclick="zoomOut()">−</button>
    </div>
    <button class="reset-btn" onclick="resetToLatest()">↻ Återställ</button>
  </div>
  <div id="maps">
    <div id="map1" class="map"></div>
    <div id="map2" class="map"></div>
  </div>
</div>
<script>
  // Version: 1.1
  // -------------------------------------------------
  // ÄNDRA DESSA
  // -------------------------------------------------
  const INSTANCE_ID = "2bbec43f-37c2-460b-bf4c-3145b8b2d1c0";
  const LAYER_LEFT  = "EW_HH_DB";
  const LAYER_RIGHT = "FALSK_FARG";
  const INITIAL_CENTER = ol.proj.fromLonLat([20.0, 60.2]);
  const INITIAL_ZOOM   = 10;
  
  // Molntäckning alltid 100%
  const CLOUD_COVERAGE = 100;
  
  // Dagens datum som startdatum
  const today = new Date();
  let date1 = new Date(today);
  let date2 = new Date(today);
  let date1Modified = false;
  let date2Modified = false;
  
  // -------------------------------------------------
  function formatDate(date) {
    return date.toISOString().split('T')[0];
  }
  
  function overlayLayer() {
    // Högupplösta tiles med stor, svart text
    return new ol.layer.Tile({
      source: new ol.source.XYZ({
        url: 'https://{1-4}.basemaps.cartocdn.com/rastertiles/voyager_only_labels/{z}/{x}/{y}@2x.png',
        crossOrigin: 'anonymous',
        tilePixelRatio: 2
      })
    });
  }
  
  function sentinelLayer(layerId, date) {
    const dateStr = formatDate(date);
    return new ol.layer.Tile({
      source: new ol.source.TileWMS({
        url: "https://sh.dataspace.copernicus.eu/ogc/wms/" + INSTANCE_ID,
        params: {
          LAYERS: layerId,
          FORMAT: "image/png",
          TRANSPARENT: true,
          TIME: dateStr + '/' + dateStr,
          MAXCC: CLOUD_COVERAGE
        },
        crossOrigin: "anonymous"
      })
    });
  }
  
  const view1 = new ol.View({
    center: INITIAL_CENTER,
    zoom: INITIAL_ZOOM
  });
  const view2 = new ol.View({
    center: INITIAL_CENTER,
    zoom: INITIAL_ZOOM
  });
  
  const map1 = new ol.Map({
    target: "map1",
    layers: [
      sentinelLayer(LAYER_LEFT, date1),
      overlayLayer()
    ],
    view: view1,
    controls: []
  });
  
  const map2 = new ol.Map({
    target: "map2",
    layers: [
      sentinelLayer(LAYER_RIGHT, date2),
      overlayLayer()
    ],
    view: view2,
    controls: []
  });
  
  // -------------------------------------------------
  // Datum-kontroller
  // -------------------------------------------------
  function updateDateDisplay(mapNum) {
    const dateEl = document.getElementById('date' + mapNum);
    const modified = mapNum === 1 ? date1Modified : date2Modified;
    const date = mapNum === 1 ? date1 : date2;
    
    if (modified) {
      dateEl.textContent = formatDate(date);
      dateEl.className = 'date-display modified';
    } else {
      dateEl.textContent = 'Senaste';
      dateEl.className = 'date-display default';
    }
  }
  
  function changeDate(mapNum, days) {
    if (mapNum === 1) {
      // Om vi är på "Senaste" och stegar framåt, gå till dagens datum först
      if (!date1Modified && days > 0) {
        // Redan på dagens datum, gör ingenting
        date1Modified = true;
        updateDateDisplay(1);
        return;
      }
      
      date1.setDate(date1.getDate() + days);
      date1Modified = true;
      updateDateDisplay(1);
      map1.getLayers().clear();
      map1.addLayer(sentinelLayer(LAYER_LEFT, date1));
      map1.addLayer(overlayLayer());
    } else {
      // Om vi är på "Senaste" och stegar framåt, gå till dagens datum först
      if (!date2Modified && days > 0) {
        // Redan på dagens datum, gör ingenting
        date2Modified = true;
        updateDateDisplay(2);
        return;
      }
      
      date2.setDate(date2.getDate() + days);
      date2Modified = true;
      updateDateDisplay(2);
      map2.getLayers().clear();
      map2.addLayer(sentinelLayer(LAYER_RIGHT, date2));
      map2.addLayer(overlayLayer());
    }
  }
  
  function resetToLatest() {
    // Återställ datum till idag
    date1 = new Date(today);
    date2 = new Date(today);
    date1Modified = false;
    date2Modified = false;
    
    // Uppdatera display
    updateDateDisplay(1);
    updateDateDisplay(2);
    
    // Ladda om kartor
    map1.getLayers().clear();
    map1.addLayer(sentinelLayer(LAYER_LEFT, date1));
    map1.addLayer(overlayLayer());
    
    map2.getLayers().clear();
    map2.addLayer(sentinelLayer(LAYER_RIGHT, date2));
    map2.addLayer(overlayLayer());
    
    // Återställ position och zoom
    view1.setCenter(INITIAL_CENTER);
    view1.setZoom(INITIAL_ZOOM);
    view2.setCenter(INITIAL_CENTER);
    view2.setZoom(INITIAL_ZOOM);
  }
  
  // -------------------------------------------------
  // Zoom-kontroller
  // -------------------------------------------------
  function zoomIn() {
    const currentZoom = view1.getZoom();
    view1.setZoom(currentZoom + 0.5);
    view2.setZoom(currentZoom + 0.5);
  }
  
  function zoomOut() {
    const currentZoom = view1.getZoom();
    view1.setZoom(currentZoom - 0.5);
    view2.setZoom(currentZoom - 0.5);
  }
  
  // -------------------------------------------------
  // Synk pan + zoom
  // -------------------------------------------------
  let syncing = false;
  function syncViews(source, target) {
    if (syncing) return;
    syncing = true;
    target.setCenter(source.getCenter());
    target.setZoom(source.getZoom());
    target.setRotation(source.getRotation());
    syncing = false;
  }
  
  view1.on("change:center", () => syncViews(view1, view2));
  view1.on("change:resolution", () => syncViews(view1, view2));
  view2.on("change:center", () => syncViews(view2, view1));
  view2.on("change:resolution", () => syncViews(view2, view1));
</script>
</body>

</html>
